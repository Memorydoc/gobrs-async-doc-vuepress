---
title: 动态任务 
date: 2020-05-11 13:54:56 
permalink: /pages/2f844c
article: false
---

## 如何开发一个异步任务

::: warning 恭喜你 
看到这里，小伙伴们是不是已经迫不及待的想真正的体验一下 <code>**Gobrs-Async**</code> 是怎样开发一个异步任务的。 那么下面由我带领大家来感受一下 一个完整的 
<code>**AsyncTask**</code> 需要怎么开发。
:::

## 创建 Bean 实现 AsyncTask

> 这里 AsyncTask<T, V> 是一个泛型接口

* T 代表 任务的参数类型
* V 代表 任务的返回类型

如下：

```java 
/**
 * @program: gobrs-async
 * @ClassName TaskBean
 * @description: 异步任务 任务参数 String类型 任务返回 Map类型
 * @author: sizegang
 * @create: 2022-03-06
 **/
@Service
public class TaskBean implements AsyncTask<String, Map> {


    @Override
    public void callback(boolean success, String param, TaskResult<Map> workResult) {

    }

    @Override
    public Map task(String params, GobrsAsyncSupport support) {
        return null;
    }

    @Override
    public boolean nessary(String params, GobrsAsyncSupport support) {
        return false;
    }
}
```
### 核心任务执行

核心任务为使用者最为关注的功能方法，需要开发RPC、HTTP、IO 等消耗系统资源的业务逻辑。
```java 
@Override
public Map task(String params, GobrsAsyncSupport support) {
    return null;
}
```


#### 获取依赖结果
**Gobrs-Async** 提供了 <code>getResult</code> 方法，无需用户关注如何获取到的依赖结果，只需要按照使用方式便可轻松获取所需结果值
```java
@Override
public Map task(String params, GobrsAsyncSupport support) {
    Map result = getResult(support, AService.class, Map.class);
    return null;
}
```
<code>getResult</code> 有三个参数
* GobrsAsyncSupport ： **Gobrs-Async** 所需要的核心参数，通过 <code>task</code> 方法中的参数透穿即可
* Class: 所依赖的 Bean的 Java 类型
* Class: 返回结果的类型 


### 可选的任务执行

**Gobrs-Async**  会根据 <code>nessary</code>  的返回结果，判断当前<code>task</code> 是否需要执行 如果返回<code>true</code> 则需要被执行，否则返之。

例如： 当参数为 <code>cancel</code> 时， 任务不执行。

```java 
@Override
public boolean nessary(String params, GobrsAsyncSupport support) {
    if("cancel".equals(params)){
        return false;
    }
    return true;
}
```

### 任务成功回调

如果你想在任务执行完成后做一些额外的操作。例如打印日志、发送邮件、发送MQ、记录信息等。 **Gobrs-Async**  同样也为你考虑到了。通过实现 callback 方法。会让你轻松的拿到
任务的执行结果。

```java 
@Override
public void callback(boolean success, String param, TaskResult<Map> workResult) {
    if(success){
        // 
        Map result = workResult.getResult();
        //  to send mq result
    }else{
        // to console or  报警
    }
}
```













